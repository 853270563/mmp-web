<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="CASE">

    <sql id="queryDynSql">
        <isNotEmpty prepend="AND" property="CASE_ID">
            T.CASE_ID = #CASE_ID#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="CUSTOMER_ID">
            T.CUSTOMER_ID = #CUSTOMER_ID#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="PRODUCT_ID">
            T.PRODUCT_ID = #PRODUCT_ID#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="IMAGE_CODE">
            T.IMAGE_CODE = #IMAGE_CODE#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="APPLY_AMOUNT">
            T.APPLY_AMOUNT = #APPLY_AMOUNT#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="CASE_STATUS">
            T.CASE_STATUS = #CASE_STATUS#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="USER_MANAGER_ID">
            T.USER_MANAGER_ID = #USER_MANAGER_ID#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="USER_AUDIT_ID">
            T.USER_AUDIT_ID = #USER_AUDIT_ID#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="USER_KEYBOARDER_ID">
            T.USER_KEYBOARDER_ID = #USER_KEYBOARDER_ID#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="CASE_DATE">
            T.CASE_DATE = #CASE_DATE#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="CREATE_TIME">
            T.CREATE_TIME = #CREATE_TIME#
        </isNotEmpty>


        <isNotEmpty prepend="AND" property="CASE_STATUSS">
            T.CASE_STATUS IN ('$CASE_STATUSS$')
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="START_DATE">
            <![CDATA[
               T.CASE_DATE >= #START_DATE#
             ]]>
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="END_DATE">
            <![CDATA[
               T.CASE_DATE <= #END_DATE#
             ]]>
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="CUSTOMER_ID">
            U.CUSTOMER_ID = #CUSTOMER_ID#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="CUSTOMER_NAME">
            U.CUSTOMER_NAME = #CUSTOMER_NAME#
        </isNotEmpty>
    </sql>

    <sql id="coreSql">
        SELECT T.* FROM ${schema.xd}.CASE T
        <dynamic prepend="WHERE">
            <include refid="queryDynSql"/>
        </dynamic>
        <![CDATA[ ORDER BY T.CASE_ID]]>
    </sql>

    <select id="pageQuery" parameterClass="map" resultClass="java.util.HashMap">
        <include refid="public.pageBegin"/>
        <include refid="coreSql"/>
        <include refid="public.pageEnd"/>
    </select>

    <select id="pageCount" parameterClass="map" resultClass="int">
        <![CDATA[
			SELECT COUNT('') CNT
			FROM ${schema.xd}.CASE T
		]]>
        <dynamic prepend="WHERE">
            <include refid="queryDynSql"/>
        </dynamic>
    </select>

    <insert id="insert" parameterClass="map">
        INSERT INTO ${schema.xd}.CASE
        (
        CASE_ID
        <isNotEmpty prepend="," property="CUSTOMER_ID">CUSTOMER_ID</isNotEmpty>
        <isNotEmpty prepend="," property="PRODUCT_ID">PRODUCT_ID</isNotEmpty>
        <isNotEmpty prepend="," property="IMAGE_CODE">IMAGE_CODE</isNotEmpty>
        <isNotEmpty prepend="," property="APPLY_AMOUNT">APPLY_AMOUNT</isNotEmpty>
        <isNotEmpty prepend="," property="CASE_STATUS">CASE_STATUS</isNotEmpty>
        <isNotEmpty prepend="," property="USER_MANAGER_ID">USER_MANAGER_ID</isNotEmpty>
        <isNotEmpty prepend="," property="USER_AUDIT_ID">USER_AUDIT_ID</isNotEmpty>
        <isNotEmpty prepend="," property="USER_KEYBOARDER_ID">USER_KEYBOARDER_ID</isNotEmpty>
        <isNotEmpty prepend="," property="CASE_DATE">CASE_DATE</isNotEmpty>
        <isNotEmpty prepend="," property="CREATE_TIME">CREATE_TIME</isNotEmpty>
        ) VALUES (
        #CASE_ID#
        <isNotEmpty prepend="," property="CUSTOMER_ID">#CUSTOMER_ID#</isNotEmpty>
        <isNotEmpty prepend="," property="PRODUCT_ID">#PRODUCT_ID#</isNotEmpty>
        <isNotEmpty prepend="," property="IMAGE_CODE">#IMAGE_CODE#</isNotEmpty>
        <isNotEmpty prepend="," property="APPLY_AMOUNT">#APPLY_AMOUNT#</isNotEmpty>
        <isNotEmpty prepend="," property="CASE_STATUS">#CASE_STATUS#</isNotEmpty>
        <isNotEmpty prepend="," property="USER_MANAGER_ID">#USER_MANAGER_ID#</isNotEmpty>
        <isNotEmpty prepend="," property="USER_AUDIT_ID">#USER_AUDIT_ID#</isNotEmpty>
        <isNotEmpty prepend="," property="USER_KEYBOARDER_ID">#USER_KEYBOARDER_ID#</isNotEmpty>
        <isNotEmpty prepend="," property="CASE_DATE">#CASE_DATE#</isNotEmpty>
        <isNotEmpty prepend="," property="CREATE_TIME">#CREATE_TIME#</isNotEmpty>
        )
    </insert>

    <update id="updateById" parameterClass="map">
        <![CDATA[ update ${schema.xd}.CASE ]]>
        <dynamic prepend="set">
            <isNotNull prepend="," property="CUSTOMER_ID">CUSTOMER_ID = #CUSTOMER_ID#</isNotNull>
            <isNotNull prepend="," property="PRODUCT_ID">PRODUCT_ID = #PRODUCT_ID#</isNotNull>
            <isNotNull prepend="," property="IMAGE_CODE">IMAGE_CODE = #IMAGE_CODE#</isNotNull>
            <isNotNull prepend="," property="APPLY_AMOUNT">APPLY_AMOUNT = #APPLY_AMOUNT#</isNotNull>
            <isNotNull prepend="," property="CASE_STATUS">CASE_STATUS = #CASE_STATUS#</isNotNull>
            <isNotNull prepend="," property="USER_MANAGER_ID">USER_MANAGER_ID = #USER_MANAGER_ID#</isNotNull>
            <isNotNull prepend="," property="USER_AUDIT_ID">USER_AUDIT_ID = #USER_AUDIT_ID#</isNotNull>
            <isNotNull prepend="," property="USER_KEYBOARDER_ID">USER_KEYBOARDER_ID = #USER_KEYBOARDER_ID#</isNotNull>
            <isNotNull prepend="," property="CASE_DATE">CASE_DATE = #CASE_DATE#</isNotNull>
            <isNotNull prepend="," property="CREATE_TIME">CREATE_TIME = #CREATE_TIME#</isNotNull>
        </dynamic>
        <![CDATA[ where CASE_ID = #CASE_ID# ]]>
    </update>

    <delete id="delete" parameterClass="map">
        <![CDATA[
         delete from ${schema.xd}.CASE where CASE_ID = #CASE_ID#
        ]]>
    </delete>

    <select id="query" parameterClass="map" resultClass="java.util.HashMap">
        <include refid="coreSql"/>
    </select>

    <select id="queryFull" parameterClass="map" resultClass="java.util.HashMap">
        SELECT
          T.*,
          U.CUSTOMER_ID, U.CUSTOMER_NAME,
          SU.ID AS USER_MANAGER_ID, SU.NAME AS USER_MANAGER_NAME,
          P.PRODUCT_ID, P.PRODUCT_NAME FROM ${schema.xd}.CASE T
        LEFT JOIN ${schema.xd}.CUSTOMER U ON T.CUSTOMER_ID = U.CUSTOMER_ID
        LEFT JOIN ${schema.configPlat}.SYS_USER SU ON T.USER_MANAGER_ID = SU.ID
        LEFT JOIN ${schema.xd}.PRODUCT P ON T.PRODUCT_ID = P.PRODUCT_ID
        <dynamic prepend="WHERE">
            <include refid="queryDynSql"/>
        </dynamic>
        <![CDATA[ ORDER BY T.CASE_ID]]>
    </select>

    <select id="seq" resultClass="String">
        select ${schema.interPlat}.nextval('SEQ_CASE') from dual
    </select>

</sqlMap>

