<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="FINA_SERV_CONT">

	<!-- 动态查询 and 列表分页 -->
	<sql id="queryDynSql"> 
	    <isNotNull prepend="AND" property="PARA_VALUE">
			D.VALUE = #PARA_VALUE#
		</isNotNull>
		<isNotNull prepend="AND" property="TYPE_SECO_ID">
			C.TYPE_SECO_ID = #TYPE_SECO_ID#
		</isNotNull>
		<isNotNull prepend="AND" property="TYPE_THIR_ID">
			B.TYPE_THIR_ID = #TYPE_THIR_ID#
		</isNotNull>
	</sql>
	
	<!-- 查询SQL -->
	<sql id="coreSql">
		SELECT A.*,D.VALUE ,D.PARA_NAME_CN,C.TYPE_SECO_NAME,
C.TYPE_SECO_ID,B.TYPE_THIR_NAME,B.TYPE_THIR_ID FROM ${schema.interPlat}.FINA_SERV_CONT A
LEFT JOIN ${schema.interPlat}.FINA_SERV_THIR B ON A.INFO_DESC_ID=B.INFO_DESC_ID
LEFT JOIN ${schema.interPlat}.FINA_SERV_SECO C ON C.TYPE_SECO_ID=B.TYPE_SECO_ID
LEFT JOIN ${schema.configPlat}.SYS_DICT D ON TYPE = 'TYPE_FIRS_ID' AND C.TYPE_FIRS_ID=D.VALUE
		<dynamic prepend="WHERE ">
			<include refid="queryDynSql" />
		</dynamic>
		ORDER BY D.VALUE ,C.TYPE_SECO_ID,B.TYPE_THIR_ID
	</sql>

		<!-- 查询SQL -->
<!-- 	<select id="queryFina" parameterClass="map" resultClass="java.util.HashMap">
			SELECT A.*,D.VALUE AS FIRS_ID,C.TYPE_SECO_NAME,C.TYPE_SECO_ID,B.TYPE_THIR_NAME,B.TYPE_THIR_ID FROM ${schema.interPlat}.FINA_SERV_CONT A
LEFT JOIN ${schema.interPlat}.FINA_SERV_THIR B ON A.INFO_DESC_ID=B.INFO_DESC_ID
LEFT JOIN ${schema.interPlat}.FINA_SERV_SECO C ON C.TYPE_SECO_ID=B.TYPE_SECO_ID
LEFT JOIN ${schema.configPlat}.SYS_DICT D ON TYPE = 'TYPE_FIRS_ID' AND C.TYPE_FIRS_ID=D.VALUE
		<dynamic prepend="WHERE ">
			<include refid="queryDynSql" />
		</dynamic>
	</select> -->
	
	<!-- 分页查询 -->
	<select id="pageQuery" parameterClass="map" resultClass="java.util.HashMap">
		<!-- <include refid="pageCount" /> -->
		<include refid="coreSql" />
	</select>

	<!-- 分页计数 -->
	<select id="pageCount" parameterClass="map" resultClass="int">
		<![CDATA[
			SELECT COUNT(A.INFO_DESC_ID) CNT 
			FROM ${schema.interPlat}.FINA_SERV_CONT A
		]]>
		<dynamic prepend="WHERE">
			<include refid="queryDynSql" />
		</dynamic>
	</select>

	<!-- 增加、修改时将信息存放到op表中 -->
	<insert id="insert" parameterClass="map">
		INSERT INTO ${schema.interPlat}.FINA_SERV_CONT_OP
		( INFO_DESC_ID,INFO_TITLE,INFO_CONT,INFO_TYPE ) 
		VALUES ( #INFO_DESC_ID#,#INFO_TITLE#,#INFO_CONT#,#INFO_TYPE#  )
	</insert>

	<!-- 删除时存放删除表的信息 -->
	<insert id="insertSelect" parameterClass="map">
		INSERT INTO
		${schema.interPlat}.FINA_SERV_CONT_OP
		select * from ${schema.interPlat}.FINA_SERV_CONT where INFO_DESC_ID= #INFO_DESC_ID#
	</insert>

	<!-- 查询P_WARM_TIPS_OP是否有待审核的数据 -->
	<select id="findOp" parameterClass="map" resultClass="java.util.HashMap">
		select *
		from ${schema.interPlat}.FINA_SERV_CONT_OP t1
		INNER JOIN ${schema.configPlat}.AUDI_DETAIL_OP t2 ON t1.AUDI_ID = t2.AUDI_ID
		where t1.RID = #RID# and t2.AUDI_STAT ='3'
	</select>

	<select id="count" parameterClass="map" resultClass="int">
		<![CDATA[ 
			SELECT COUNT(P.RID) FROM ${schema.interPlat}.FINA_SERV_CONT p 
			 WHERE P.RID=#RID#
		]]>
	</select>
	
	<update id="updateById" parameterClass="map">
		<![CDATA[ update ${schema.interPlat}.FINA_SERV_CONT ]]>
		<dynamic prepend="set">
			<!-- 现在审核ID -->
			<isNotNull property="AUDI_ID" prepend=","><![CDATA[ AUDI_ID = #AUDI_ID# ]]></isNotNull>
		</dynamic>
		<![CDATA[ where INFO_DESC_ID = #INFO_DESC_ID# ]]>
	</update>

	<!-- 删除操作 -->
	<delete id="delete" parameterClass="map">
		<![CDATA[ delete from ${schema.interPlat}.FINA_SERV_CONT where INFO_DESC_ID = #INFO_DESC_ID# ]]>
	</delete>

	<!-- 查询操作 -->
	<select id="query" parameterClass="map" resultClass="java.util.HashMap">
		<include refid="coreSql" />
	</select>
	 
	
</sqlMap>

