<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ARES_WX_MSG_TASK">
    <insert id="insert" parameterClass="java.util.HashMap">
        insert into ${schema.configPlat}.ARES_WX_MSG_TASK
           (TASK_ID,
            MSG_BODY,
            SEND_BEGIN_TIME,
            SEND_END_TIME,
            STATUS,
            CREATE_TIME,
            UPDATE_TIME,
            OPER_ID)
        VALUES
           (#TASK_ID#,
            #MSG_BODY#,
            #SEND_BEGIN_TIME#,
            #SEND_END_TIME#,
            '0',
            current timestamp,
            #UPDATE_TIME#,
            #OPER_ID#)
    </insert>
    <update id="updateWxMsgTaskStatus" parameterClass="java.util.Map" >
        UPDATE   ${schema.configPlat}.ARES_WX_MSG_TASK
        SET
        UPDATE_TIME=current timestamp
        <isNotEmpty property="STATUS">
            ,STATUS = #STATUS#
        </isNotEmpty>
        WHERE  TASK_ID=#TASK_ID#
    </update>
    <select id="findWxMsgTask" resultClass="java.util.HashMap">
        SELECT t.* from ${schema.configPlat}.ARES_WX_MSG_TASK t where t.status='0'   AND <![CDATA[ T.SEND_BEGIN_TIME <= current timestamp ]]>
					AND <![CDATA[ (T.SEND_END_TIME IS NULL
							OR T.SEND_END_TIME >= current timestamp
						)]]>
    </select>

	<select id="loadSeq" resultClass="java.util.HashMap">
		SELECT ${schema.configPlat}.SEQ_WX_MSG_TASK.NEXTVAL AS TASK_ID FROM DUAL
	</select>
</sqlMap>

